{"componentChunkName":"component---src-templates-blog-post-js","path":"/dynamic-canvas/","result":{"data":{"site":{"siteMetadata":{"title":"Isaiah's Blog"}},"markdownRemark":{"id":"24f374ec-ba87-5c3c-845a-8854ebbef823","excerpt":"This is a cross post from DEV Community. Original URL: https://dev.to/isaiahnixon5/how-to-make-a-dynamic-animated-responsive-canvas-element-3kb3  When creating…","html":"<blockquote>\n<p>This is a cross post from <a href=\"https://dev.to\">DEV Community</a>. Original URL: <a href=\"https://dev.to/isaiahnixon5/how-to-make-a-dynamic-animated-responsive-canvas-element-3kb3\">https://dev.to/isaiahnixon5/how-to-make-a-dynamic-animated-responsive-canvas-element-3kb3</a></p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/10857ef3b9da14037d5a9e725dd59fb7/88409/responsive-canvas.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.72999035679845%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAyklEQVQoz42SUQ6CMBBEew+FsgttMTHihx9GEw/g/e8z7hZaSjHRj8kulHmd3WCYGUlENFeWSlJ7AjlG8B7T2ElP+az0JJ/KlA9ZC6wLFs6d4IcRnRdgELOn9Rvee80OFm8VOYv2fAH7gGMrvZUzTahQR7+BOWkaNabpI+hxJdwngpVeE25S1iNvYBVQEx0bxvtJeN2kb+W8ApZ7VJn9uPPicxKBHwTaKGz4Y+Qy3WbsZFbooniJvuu/A3PCeg/5t0nQsMITrPal+gGpe9/A2EVsIAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"A visual representation of the orbits of Earth and Mars around the sun with the distance between them marked in astronomical units.\"\n        title=\"A visual representation of the orbits of Earth and Mars around the sun with the distance between them marked in astronomical units.\"\n        src=\"/static/10857ef3b9da14037d5a9e725dd59fb7/799d3/responsive-canvas.png\"\n        srcset=\"/static/10857ef3b9da14037d5a9e725dd59fb7/00d96/responsive-canvas.png 148w,\n/static/10857ef3b9da14037d5a9e725dd59fb7/0b23c/responsive-canvas.png 295w,\n/static/10857ef3b9da14037d5a9e725dd59fb7/799d3/responsive-canvas.png 590w,\n/static/10857ef3b9da14037d5a9e725dd59fb7/2a3d6/responsive-canvas.png 885w,\n/static/10857ef3b9da14037d5a9e725dd59fb7/ae92f/responsive-canvas.png 1180w,\n/static/10857ef3b9da14037d5a9e725dd59fb7/88409/responsive-canvas.png 2074w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>When creating <a href=\"https://where-is-mars.isaiahnixon.com/\">Where is Mars?</a> I had data that I needed a visual representation of. I knew <code class=\"language-text\">&lt;canvas&gt;</code> was the answer. But, I didn’t quite know how to get it there. It took a bit of research and trial-and-error but I made it work. I figured this could help someone else, so I thought I would share it here.</p>\n<h1>The Responsive Canvas</h1>\n<p>First, we need a canvas element.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\">    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>canvas</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>responsive-canvas<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>canvas</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>For me, CSS is the easiest way to place and size the canvas how I want.</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\">    <span class=\"token selector\">canvas#responsive-canvas</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 100%<span class=\"token punctuation\">;</span>\n      <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 100%<span class=\"token punctuation\">;</span>\n      <span class=\"token property\">position</span><span class=\"token punctuation\">:</span> fixed<span class=\"token punctuation\">;</span>\n      <span class=\"token property\">left</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n      <span class=\"token property\">top</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n      <span class=\"token property\">z-index</span><span class=\"token punctuation\">:</span> -1<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>Finally, we need a couple of JS variables to interact with this component.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">    <span class=\"token keyword\">const</span> c <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"responsive-canvas\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> c<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2d\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h1>Feed the Canvas its Own Size</h1>\n<p>The canvas size is controlled by CSS. As such, the context in JS doesn’t know where to draw things. Run this function each time before drawing anything on the context:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">setUpCanvas</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    \t<span class=\"token comment\">// Feed the size back to the canvas.</span>\n        c<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> c<span class=\"token punctuation\">.</span>clientWidth<span class=\"token punctuation\">;</span>\n        c<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> c<span class=\"token punctuation\">.</span>clientHeight<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h1>Draw on the Canvas in Ratios</h1>\n<p>Whenever making a responsive canvas drawing, everything must be done in ratios. As such, it is important to know the minimum value between the width and the height:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">    <span class=\"token keyword\">const</span> min <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This can be used to draw components that have the same relative size, no matter the screen. For example:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">    ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"#FFAA1D\"</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">beginPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">arc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">.</span>width<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">.</span>height<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>min <span class=\"token operator\">*</span> <span class=\"token number\">0.04</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span> <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h1>Tie the Drawing to Window Resize</h1>\n<p>The code for drawing components on the canvas should be wrapped in a function:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">drawComponents</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    \t<span class=\"token comment\">/* Code for drawing on the canvas */</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This function, along with <code class=\"language-text\">setUpCanvas()</code> from the previous section should be called whenever the window is resized. You’ll end up with something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">    window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'resize'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    \t<span class=\"token comment\">// Clear the canvas.</span>\n    \tctx<span class=\"token punctuation\">.</span><span class=\"token function\">clearRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    \t<span class=\"token comment\">// Draw it all again.</span>\n    \t<span class=\"token function\">setUpCanvas</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \t<span class=\"token function\">drawComponents</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h1>Animate Through Intervals</h1>\n<p>If you want to do any animations with the components, you will need your <code class=\"language-text\">drawComponents()</code> function to return the output of a <code class=\"language-text\">setInterval()</code> function. This will look something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">drawComponents</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    \t<span class=\"token comment\">/* Code for drawing on the canvas */</span>\n    \n    \t<span class=\"token comment\">// Return the animation interval.</span>\n    \t<span class=\"token keyword\">return</span> <span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    \t\t<span class=\"token comment\">/* Code for changes to canvas over time. */</span>\n    \t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Then you will want to capture this interval when <code class=\"language-text\">drawComponents()</code> is called and clear it away when the window is resized. Like so:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">    <span class=\"token function\">setUpCanvas</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> animationInterval <span class=\"token operator\">=</span> <span class=\"token function\">drawComponents</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'resize'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    \t<span class=\"token comment\">// Clear the canvas.</span>\n    \tctx<span class=\"token punctuation\">.</span><span class=\"token function\">clearRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    \t<span class=\"token comment\">// End the old animation.</span>\n    \t<span class=\"token function\">clearInterval</span><span class=\"token punctuation\">(</span>animationInterval<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    \t<span class=\"token comment\">// Draw it all again.</span>\n    \t<span class=\"token function\">setUpCanvas</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \tanimationInterval <span class=\"token operator\">=</span> <span class=\"token function\">drawComponents</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h1>Dynamically Update the Data</h1>\n<p>In my case, I also wanted the data that the canvas represented to be updated every minute. First, add the data as an input to <code class=\"language-text\">drawComponents():</code></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">drawComponents</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    \t<span class=\"token comment\">/* Code for drawing on the canvas, based on data */</span>\n    \n    \t<span class=\"token comment\">// Return the animation interval.</span>\n    \t<span class=\"token keyword\">return</span> <span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    \t\t<span class=\"token comment\">/* Code for changes to canvas over time. */</span>\n    \t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Then, take the logic from the window resize event, and make a general <code class=\"language-text\">reset()</code> function that takes the new data object, and an animation interval as inputs.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">reset</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">data<span class=\"token punctuation\">,</span> animationInterval</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    \t<span class=\"token comment\">// Clear the canvas.</span>\n    \tctx<span class=\"token punctuation\">.</span><span class=\"token function\">clearRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    \t<span class=\"token comment\">// End the old animation.</span>\n    \t<span class=\"token function\">clearInterval</span><span class=\"token punctuation\">(</span>animationInterval<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    \t<span class=\"token comment\">// Draw it all again.</span>\n    \t<span class=\"token function\">setUpCanvas</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \t<span class=\"token keyword\">return</span> <span class=\"token function\">drawComponents</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Finally, your code should look something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">    <span class=\"token function\">setUpCanvas</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> data <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> animationInterval <span class=\"token operator\">=</span> <span class=\"token function\">drawComponents</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    \t<span class=\"token comment\">// Update data.</span>\n    \tdata <span class=\"token operator\">=</span> <span class=\"token string\">\"cool new data\"</span><span class=\"token punctuation\">;</span>\n    \tanimationInterval <span class=\"token operator\">=</span> <span class=\"token function\">reset</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> animationInterval<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">60000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'resize'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    \tanimationInterval <span class=\"token operator\">=</span> <span class=\"token function\">reset</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> animationInterval<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h1>Final Code</h1>\n<p>You can see how the final code all came together in <a href=\"https://github.com/isaiahnixon/where-is-mars/blob/d375e9877b8c29c035b8843ef8a75d5aed2cc9f5/js/main.js\">main.js</a>.</p>","frontmatter":{"title":"How to Make a Dynamic, Animated, and Responsive Canvas Element","date":"March 25, 2020","description":"It took a bit of research and trial-and-error but I made it work."}}},"pageContext":{"slug":"/dynamic-canvas/","previous":{"fields":{"slug":"/complexity-and-complication/"},"frontmatter":{"title":"Complexity, Complication, and Crafting Software"}},"next":{"fields":{"slug":"/automatic-file-backups/"},"frontmatter":{"title":"Easy Automatic File Backups with Borg | Ubuntu 18.04"}}}}}